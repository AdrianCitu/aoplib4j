
<span style="font-size: 120%; font-weight: bold;">FieldValidationHowTo</span>
&nbsp;


<div style="font-style: italic; margin-top: 3px;">How to use
@Validate annotation.</div>

</div>
<h3><a name="Introduction">Introduction</a></h3>
<p><a name="Introduction">This page is a small tutorial about
the <tt>@Validation</tt> annotation. </a></p>
<h3><a name="How_to_use_the_@Validation_annotation_(in_2_seconds)">How
to use the <tt>@Validation</tt> annotation (in 2 seconds)</a></h3>
<ol>
	<li><a name="How_to_use_the_@Validation_annotation_(in_2_seconds)">Create
	your own validation class extending the <tt>FieldValidator</tt> class.
	</a></li>
	<li><a name="How_to_use_the_@Validation_annotation_(in_2_seconds)">Annotate
	the field to validate with the <tt>@Validation</tt> annotation and pass
	as value of the <tt>validationClass</tt> your own validation class
	name. </a></li>
</ol>
<h3><a name="How_to_use_the_@Validation_annotation_(in_5_minutes)">How
to use the <tt>@Validation</tt> annotation (in 5 minutes)</a></h3>
<p><a name="How_to_use_the_@Validation_annotation_(in_5_minutes)">The
<tt>@Validation</tt> annotation is should be added on fields on which a
validation should be done. The annotation have a single parameter (<tt>validationClass</tt>)
representing the class that will be instantiated and used for the
validation. </a></p>
<p><a name="How_to_use_the_@Validation_annotation_(in_5_minutes)">Code
example (taken from the JUnit tests): </a></p>
<pre class="prettyprint"><a
	name="How_to_use_the_@Validation_annotation_(in_5_minutes)"><span
	class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span
	class="pln"> </span><span class="typ">ClassToValidate</span><span
	class="pln"> </span><span class="pun">{</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="lit">@Validate</span><span class="pun">(</span><span class="pln">validationClass</span><span
	class="pun">=</span><span class="typ">StringValidator</span><span
	class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">private</span><span
	class="pln"> </span><span class="typ">String</span><span class="pln"> str</span><span
	class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="lit">@Validate</span><span class="pun">(</span><span class="pln">validationClass</span><span
	class="pun">=</span><span class="typ">StringValidator</span><span
	class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">private</span><span
	class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span
	class="typ">String</span><span class="pln"> staticStr</span><span
	class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="pun">...</span></a></pre>
<p><a name="How_to_use_the_@Validation_annotation_(in_5_minutes)">The
<tt>validationClass</tt> parameter should be a class that inherits from
the <tt>FieldValidator</tt> abstract class. The structure of the <tt>FieldValidator</tt>
: </a></p>
<pre class="prettyprint"><a
	name="How_to_use_the_@Validation_annotation_(in_5_minutes)"><span
	class="kwd">public</span><span class="pln"> abstract </span><span
	class="kwd">class</span><span class="pln"> </span><span class="typ">FieldValidator</span><span
	class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* The default constructor.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="typ">FieldValidator</span><span
	class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span
	class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="pun">}</span><span class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Method to implement the validation of the field.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;* @param fldInfor object containing the information about the field<br>&nbsp; &nbsp; &nbsp;* validation.<br>&nbsp; &nbsp; &nbsp;* @throws Exception any exception to signal that the new value to be <br>&nbsp; &nbsp; &nbsp;* assigned to the field is not valid.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> abstract </span><span class="kwd">void</span><span
	class="pln"> validate</span><span class="pun">(</span><span class="typ">FieldInformation</span><span
	class="pln"> fldInfor</span><span class="pun">)</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
	class="kwd">throws</span><span class="pln"> </span><span class="typ">Exception</span><span
	class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></a></pre>
<p><a name="How_to_use_the_@Validation_annotation_(in_5_minutes)">The
<tt>FieldInformation</tt> is an interface class containing useful
informations for the validation process; the field name, the old value
of the field, the new value to be assigned to the field. The structure
of the <tt>FieldInformation</tt> interface. </a></p>
<pre class="prettyprint"><a
	name="How_to_use_the_@Validation_annotation_(in_5_minutes)"><span
	class="kwd">public</span><span class="pln"> </span><span class="kwd">interface</span><span
	class="pln"> </span><span class="typ">FieldInformation</span><span
	class="pln"> </span><span class="pun">{</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the field actual value.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">Object</span><span
	class="pln"> getFieldValue</span><span class="pun">();</span><span
	class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the new value that should be assigned to the field.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">Object</span><span
	class="pln"> getNewValueToAssign</span><span class="pun">();</span><span
	class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the field name.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">String</span><span
	class="pln"> getFieldName</span><span class="pun">();</span><span
	class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return true if the field is static, false otherwise.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">boolean</span><span
	class="pln"> isStaticField</span><span class="pun">();</span><span
	class="pln"><br></span><span class="pun">}</span></a></pre>
<p><a name="How_to_use_the_@Validation_annotation_(in_5_minutes)">
</a></p>
<h3><a name="The_@Validation_annotation:_under_the_hood">The <tt>@Validation</tt>
annotation: under the hood</a></h3>
<p><a name="The_@Validation_annotation:_under_the_hood">For the
validation process the work flow is the following: </a></p>
<ul>
	<li><a name="The_@Validation_annotation:_under_the_hood">Intercept
	the assignment of a field annotated with <tt>Validate</tt> </a></li>
</ul>
<blockquote><a
	name="The_@Validation_annotation:_under_the_hood">The @AspectJ
pointcuts for intercepting the assignment of a field: </a>
<ul>
	<li><a name="The_@Validation_annotation:_under_the_hood">static
	fields </a></li>
	<pre class="prettyprint"><a
		name="The_@Validation_annotation:_under_the_hood"><span
		class="pln">&nbsp; &nbsp; </span><span class="lit">@Pointcut</span><span
		class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="str">"set(@com.google.code.aoplib4j.aspectj.fieldvalidation.Validate "</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"static * *.*)"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"&amp;&amp; @annotation(validateAnnot) "</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"&amp;&amp; args(newValue)"</span><span
		class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span
		class="kwd">void</span><span class="pln"> validateStaticFieldPointcut</span><span
		class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="kwd">final</span><span class="pln"> </span><span class="typ">Validate</span><span
		class="pln"> validateAnnot</span><span class="pun">,</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="kwd">final</span><span class="pln"> </span><span class="typ">Object</span><span
		class="pln"> newValue</span><span class="pun">)</span><span
		class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span
		class="pun">}</span></a></pre>
	<li><a name="The_@Validation_annotation:_under_the_hood">non-static
	fields </a></li>
	<pre class="prettyprint"><a
		name="The_@Validation_annotation:_under_the_hood"><span
		class="pln">&nbsp; &nbsp; </span><span class="lit">@Pointcut</span><span
		class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="str">"set(@com.google.code.aoplib4j.aspectj.fieldvalidation.Validate "</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"* *.*)"</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"&amp;&amp; @annotation(validateAnnot) "</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"&amp;&amp; args(newValue) &amp;&amp; this(instance)"</span><span
		class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span
		class="kwd">void</span><span class="pln"> validateNonStaticFieldPointcut</span><span
		class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="kwd">final</span><span class="pln"> </span><span class="typ">Validate</span><span
		class="pln"> validateAnnot</span><span class="pun">,</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="kwd">final</span><span class="pln"> </span><span class="typ">Object</span><span
		class="pln"> newValue</span><span class="pun">,</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="kwd">final</span><span class="pln"> </span><span class="typ">Object</span><span
		class="pln"> instance</span><span class="pun">)</span><span
		class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span
		class="pun">}</span></a></pre>
</ul>
<a name="The_@Validation_annotation:_under_the_hood">For triggering
the validation the @Before advice is used. </a></blockquote>
<ul>
	<li><a name="The_@Validation_annotation:_under_the_hood">Create
	an instance of <tt>FieldInformation</tt> </a></li>
	<li><a name="The_@Validation_annotation:_under_the_hood">Create
	an instance of <tt>FieldValidator</tt> </a></li>
	<ol>
		<li><a name="The_@Validation_annotation:_under_the_hood">Retrieve
		the class object from the <tt>validationClass</tt> parameter of the
		annotation ( the annotation is retrieved using @AspectJ @annotation
		pointcut). </a></li>
		<li><a name="The_@Validation_annotation:_under_the_hood">Create
		a new instance by introspection (using the non argument constructor).
		</a></li>
	</ol>
	<li><a name="The_@Validation_annotation:_under_the_hood">Do
	the validation by calling <tt>FieldValidator#validate(FieldInformation
	fldInfor) </tt> </a></li>
</ul>
<h3><a
	name="Critics,_enhancements_and_..._what_i_don't_like_about_this">Critics,
enhancements and ... what i don't like about this solution</a></h3>
<ul>
	<li><a
		name="Critics,_enhancements_and_..._what_i_don't_like_about_this">The
	user validation class must inherit from <tt>FieldValidator</tt> class.
	It would be much better to just implement a Java interface. In the
	actual implementation the user must inherit from a class because the
	framework instantiate the validation class using the non-arguments
	constructor by introspection (see </a><a
		href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#newInstance%28%29"
		rel="nofollow">Class.newInstance()</a>).
	</li>
</ul>	