
<span style="font-size: 120%; font-weight: bold;">UMLSequenceDiagramHowTo</span>
&nbsp;


<div style="font-style: italic; margin-top: 3px;">How to use the
@Aoplib4jSequenceDiagram annotation.</div>

<h3><a name="Introduction">Introduction</a></h3>
<p><a name="Introduction">This page is a small tutorial about
the <tt>@Aoplib4jSequenceDiagram</tt> annotation. </a></p>
<h3><a
	name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_2_seconds">How
to use the <tt>@Aoplib4jSequenceDiagram</tt> annotation (in 2 seconds)</a></h3>
<ol>
	<li><a
		name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_2_seconds"><strong>Optional</strong>)Create
	your own diagram writer class extending the <tt>SequenceDiagramWriter</tt>.
	</a></li>
	<li><a
		name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_2_seconds">nnotate
	the method(s) for which you want to generate the sequence diagram with
	the <tt>@Aoplib4jSequenceDiagram</tt> annotation and add as value for
	the <tt>diagramWriter</tt> attribute your own writer class name one of
	the writers offered by <tt>AopLib4j</tt>. </a></li>
	<li><a
		name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_2_seconds">xecute
	the annotated method and retrieve the file representing the sequence
	diagram from the java.io.tmpdir folder (the diagram name is <tt>ClassName.annotateMethodName().txt</tt>)
	</a></li>
</ol>
<h3><a
	name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_10_minute">How
to use the <tt>@Aoplib4jSequenceDiagram</tt> annotation (in 10 minutes)</a></h3>
<p><a
	name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_10_minute">Annotate
with the <tt>@Aoplib4jSequenceDiagram</tt> annotation the method for
which a sequence diagram should be generated. The annotation have a one
mandatory parameter (<tt>diagramWriter</tt>) representing the class that
will be instantiated and used for the writing of the sequence diagram
and two optional parameters: <tt>diagramDepth</tt> representing the
maximum number of participants in the diagram and <tt>diagramFullPath</tt>
representing the full path where the diagram will be written. </a></p>
<p><a
	name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_10_minute">Code
example of <tt>Aoplib4jSequenceDiagram</tt> use(taken from the JUnit
tests): </a></p>
<pre class="prettyprint"><a
	name="How_to_use_the_@Aoplib4jSequenceDiagram_annotation_(in_10_minute"><span
	class="kwd">public</span><span class="pln"> </span><span class="kwd">class</span><span
	class="pln"> </span><span class="typ">ActorClass</span><span
	class="pln"> </span><span class="pun">...</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">//Write the diagram using the SEQUENCEWriter; the diagram will be written</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="com">//into the java.io.tmpdir/ActorClass.staticMethod().txt file</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="lit">@Aoplib4jSequenceDiagram</span><span
	class="pun">(</span><span class="pln">diagramWriter </span><span
	class="pun">=</span><span class="pln"> </span><span class="typ">SEQUENCEWriter</span><span
	class="pun">.</span><span class="kwd">class</span><span class="pun">)</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span
	class="kwd">void</span><span class="pln"> staticMethod</span><span
	class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="pun">....</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span
	class="pln"><br><br><br>&nbsp; &nbsp; </span><span
	class="com">//Write the diagram using the SEQUENCEWriter; the diagram will be written</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="com">//into the /aoplib4jtests/main.seq file.</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="lit">@Aoplib4jSequenceDiagram</span><span
	class="pun">(</span><span class="pln">diagramWriter </span><span
	class="pun">=</span><span class="pln"> </span><span class="typ">SEQUENCEWriter</span><span
	class="pun">.</span><span class="kwd">class</span><span class="pun">,</span><span
	class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; diagramFullPath </span><span
	class="pun">=</span><span class="pln"> </span><span class="str">"/aoplib4jtests/main.seq"</span><span
	class="pun">,</span><span class="pln"> diagramDepth </span><span
	class="pun">=</span><span class="pln"> </span><span class="lit">30</span><span
	class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span
	class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span
	class="pln"> actorMethod</span><span class="pun">()</span><span
	class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span
	class="pun">....</span><span class="pln"><br>&nbsp; &nbsp; </span><span
	class="pun">}</span><span class="pln"><br>&nbsp; &nbsp; </span></a></pre>
<h4><a name="Use_the_AopLib4j_diagram_writers">Use the <tt>AopLib4j</tt>
diagram writers</a></h4>
<p><a name="Use_the_AopLib4j_diagram_writers">The <tt>AopLib4j</tt>
library offers 3 sequence writers: </a></p>
<ol>
	<li><a name="Use_the_AopLib4j_diagram_writers"><tt>org.aoplib4j.uml.SEQUENCEWriter</tt>
	is a writer for the </a><a
		href="http://www.zanthan.com/itymbi/archives/cat_sequence.html"
		rel="nofollow">SEQUENCE</a> project. Here is an example of a SEQUENCE
	diagram :</li>
	<pre class="prettyprint"><span class="typ">ActorClass</span><span
		class="pun">.</span><span class="pln">actorMethod</span><span
		class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span
		class="pln"> </span><span class="kwd">void</span><span class="pun">{</span><span
		class="pln"><br></span><span class="typ">Class1</span><span
		class="pun">.</span><span class="pln">constructor</span><span
		class="pun">(</span><span class="pln">java</span><span class="pun">.</span><span
		class="pln">lang</span><span class="pun">.</span><span class="typ">String</span><span
		class="pln"> str</span><span class="pun">)</span><span class="pln"> </span><span
		class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">void</span><span
		class="pun">;</span><span class="pln"><br></span><span
		class="typ">Class1</span><span class="pun">.</span><span class="pln">method1Class1</span><span
		class="pun">()</span><span class="pln"> </span><span class="pun">-&gt;</span><span
		class="pln"> </span><span class="typ">String</span><span class="pun">;</span><span
		class="pln"><br></span><span class="typ">ActorClass</span><span
		class="pun">.[</span><span class="kwd">static</span><span class="pun">]</span><span
		class="pln">staticPrivateMethod</span><span class="pun">(</span><span
		class="pln">java</span><span class="pun">.</span><span class="pln">lang</span><span
		class="pun">.</span><span class="typ">Integer</span><span class="pln"> </span><span
		class="kwd">in</span><span class="pun">)</span><span class="pln"> </span><span
		class="pun">-&gt;</span><span class="pln"> </span><span class="kwd">void</span><span
		class="pun">;</span><span class="pln"><br></span><span
		class="pun">}</span></pre>
	<li><tt>org.aoplib4j.uml.CodeToDiagramWriter</tt> is a writer for
	the <a href="http://www.assembla.com/wiki/show/codetodiagram"
		rel="nofollow">CODETODIAGRAM</a> project. Here is an example of a
	CODETODIAGRAM diagram:</li>
	<pre class="prettyprint"><span class="pun">&lt;?</span><span
		class="pln">xml version</span><span class="pun">=</span><span
		class="str">"1.0"</span><span class="pln">encoding</span><span
		class="pun">=</span><span class="str">"UTF-8"</span><span class="pun">?&gt;</span><span
		class="pln"><br></span><span class="tag">&lt;sequence&gt;</span><span
		class="pln"><br></span><span class="tag">&lt;actors&gt;</span><span
		class="pln"><br></span><span class="tag">&lt;actor</span><span
		class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span
		class="atv">"user"</span><span class="tag">&gt;</span><span
		class="pln">ActorClass</span><span class="tag">&lt;/actor&gt;</span><span
		class="pln"><br></span><span class="tag">&lt;actor</span><span
		class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.Class1"</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"system"</span><span
		class="tag">&gt;</span><span class="pln">Class1</span><span
		class="tag">&lt;/actor&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;/actors&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;messages&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;message</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"call"</span><span
		class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> </span><span class="atn">to</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.Class1"</span><span class="pln"> <br></span><span
		class="atn">text</span><span class="pun">=</span><span class="atv">"constructor(class java.lang.String)"</span><span
		class="tag">/&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;message</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"return"</span><span
		class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.Class1"</span><span class="pln"> </span><span
		class="atn">to</span><span class="pun">=</span><span class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> <br></span><span class="atn">text</span><span
		class="pun">=</span><span class="atv">"constructor(class java.lang.String)"</span><span
		class="tag">/&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;message</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"call"</span><span
		class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> </span><span class="atn">to</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.Class1"</span><span class="pln"> <br></span><span
		class="atn">text</span><span class="pun">=</span><span class="atv">"method1Class1()"</span><span
		class="tag">/&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;message</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"return"</span><span
		class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.Class1"</span><span class="pln"> </span><span
		class="atn">to</span><span class="pun">=</span><span class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> <br></span><span class="atn">text</span><span
		class="pun">=</span><span class="atv">"method1Class1()"</span><span
		class="tag">/&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;message</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"call"</span><span
		class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> </span><span class="atn">to</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> <br></span><span class="atn">text</span><span
		class="pun">=</span><span class="atv">"staticPrivateMethod(class java.lang.Integer)"</span><span
		class="tag">/&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;message</span><span class="pln"> </span><span
		class="atn">type</span><span class="pun">=</span><span class="atv">"return"</span><span
		class="pln"> </span><span class="atn">from</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> </span><span class="atn">to</span><span class="pun">=</span><span
		class="atv">"org.aoplib4j.uml.codetodiagram.ActorClass"</span><span
		class="pln"> <br></span><span class="atn">text</span><span
		class="pun">=</span><span class="atv">"staticPrivateMethod(class java.lang.Integer)"</span><span
		class="tag">/&gt;</span><span class="pln"><br></span><span
		class="tag">&lt;/messages&gt;</span><span class="pln"><br><br></span><span
		class="tag">&lt;/sequence&gt;</span></pre>
	<li><tt>org.aoplib4j.uml.PngWriter</tt> is a writer that will
	generate a <a
		href="http://en.wikipedia.org/wiki/Portable_Network_Graphics"
		rel="nofollow">png</a> file (this writer use under the hood the <tt>org.aoplib4j.uml.SEQUENCEWriter</tt>)
	writer.</li>
	<li><span style="text-decoration: line-through;">org.aoplib4j.uml.Pic2PlotWriter<a
		href="/p/aoplib4j/w/edit/Pic2PlotWriter">?</a></span> is a writer for the <a
		href="http://www.gnu.org/software/plotutils/manual/html_chapter/plotutils_4.html"
		rel="nofollow">GNU plotutils pic2plot</a>. The implementation is not
	completely finished (due to some complexities of the pic file format).
	The <a title="sequence diagram for pic2plot product"
		href="/p/aoplib4j/issues/detail?id=79">bug#79</a> contains the a patch
	with the partial implementation; feel free to participate/propose a new
	or enhanced implementation.</li>
</ol>
<h4><a name="Create_your_own_writer">Create your own writer</a></h4>
<p><a name="Create_your_own_writer">If you want to create your
own writer implementation it should write class that inherits from the <tt>SequenceDiagramWriter</tt>
abstract class. </a></p>
<p><a name="Create_your_own_writer">Here are the most important
parts of the <tt>SequenceDiagramWriter</tt> (the full code is here </a><a
	href="http://code.google.com/p/aoplib4j/source/browse/trunk/aoplib4j/src/main/java/org/aoplib4j/uml/SequenceDiagramWriter.java"
	rel="nofollow">org.aoplib4j.uml.SequenceDiagramWriter</a>):</p>
<pre class="prettyprint"><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">class</span><span class="pln"> </span><span class="typ">SequenceDiagramWriter</span><span
	class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Default constructor.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="typ">SequenceDiagramWriter</span><span
	class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="pun">}</span><span
	class="pln"><br>&nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Write the diagram starting from the root method which is passed<br>&nbsp; &nbsp; &nbsp;* as parameter.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;* @param rootMethod the root method; the first method of the diagram.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;* @throws IOException I/O exception if any error writing.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">void</span><span class="pln"> write</span><span class="pun">(</span><span
	class="kwd">final</span><span class="pln"> </span><span class="typ">SequenceMethod</span><span
	class="pln"> rootMethod</span><span class="pun">)</span><span
	class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
	class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span
	class="pun">;</span><span class="pln"><br>&nbsp;</span><span
	class="pun">...</span><span class="pln"><br></span><span
	class="pun">}</span></pre>
<p>As you can see you have to implement only one method<tt>
public abstract void write(final SequenceMethod rootMethod)</tt>. The <tt>SequenceMethod</tt>
is an interface containing informations about the annotated method. A <tt>SequenceMethod</tt>
contains all the necessary informations concerning a method that will be
part of the sequence diagram: method name, method class, method is
static/nonStatic/constructor, return type of the method, parameters
types, parameter names, methods that this method calls and the method
that called this method.</p>
<p>The structure of the <tt>SequenceMethod</tt> interface.</p>
<pre class="prettyprint"><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">interface</span><span class="pln"> </span><span
	class="typ">SequenceMethod</span><span class="pln"> </span><span
	class="pun">{</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the (full) class name of which this method is attached to.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;* @see #getSimpleClassName()<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">String</span><span
	class="pln"> getClassName</span><span class="pun">();</span><span
	class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the method name.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; &nbsp;</span><span class="typ">String</span><span
	class="pln"> getMethodName</span><span class="pun">();</span><span
	class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the method return type.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">Class</span><span
	class="pun">&lt;</span><span class="pln"> </span><span class="pun">?</span><span
	class="pln"> </span><span class="pun">&gt;</span><span class="pln"> getReturnType</span><span
	class="pun">();</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return method parameters types.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">Class</span><span
	class="pun">&lt;</span><span class="pln"> </span><span class="pun">?</span><span
	class="pln"> </span><span class="pun">&gt;[]</span><span class="pln"> getParameterTypes</span><span
	class="pun">();</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return method parameter names.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">String</span><span
	class="pun">[]</span><span class="pln"> getParameterNames</span><span
	class="pun">();</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the collection of children.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">List</span><span
	class="pun">&lt;</span><span class="typ">SequenceMethod</span><span
	class="pun">&gt;</span><span class="pln"> getChildren</span><span
	class="pun">();</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the parent (the caller) of this method.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">SequenceMethod</span><span
	class="pln"> getParent</span><span class="pun">();</span><span
	class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return true if the node have children attached, false otherwise.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">boolean</span><span
	class="pln"> haveChildren</span><span class="pun">();</span><span
	class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return true if the method is static, false otherwise.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">boolean</span><span
	class="pln"> isStatic</span><span class="pun">();</span><span
	class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return true if the method is a constructor, false otherwise<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">boolean</span><span
	class="pln"> isConstructor</span><span class="pun">();</span><span
	class="pln"><br><br>&nbsp; &nbsp; </span><span class="com">/**<br>&nbsp; &nbsp; &nbsp;* @return the simple (no package) class name; returns null if the class<br>&nbsp; &nbsp; &nbsp;* name is null.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="typ">String</span><span
	class="pln"> getSimpleClassName</span><span class="pun">();</span><span
	class="pln"><br><br></span><span class="pun">}</span></pre>
<p>As you can see the <tt>SequenceMethod</tt> structure is actually
a tree; the root of the tree is the <tt>rootMethod</tt> and all the
methods called by the root methods are the child nodes. In order to
write a diagram you have to walk the tree; all the actual writers use
the <a href="http://en.wikipedia.org/wiki/Depth-first_search"
	rel="nofollow">Depth-First search</a> traversal technique. If your
writer needs also a DFS traversal technique then you can inherits from
the <tt>org.aoplib4j.uml.DFSDiagramWriter</tt> instead of <tt>org.aoplib4j.uml.SequenceDiagramWriter</tt>.
</p>
<p>Here is the structure of the <tt>org.aoplib4j.uml.DFSDiagramWriter</tt>
</p>
<pre class="prettyprint"><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">class</span><span class="pln"> </span><span class="typ">DFSDiagramWriter</span><span
	class="pln"> </span><span class="kwd">extends</span><span class="pln"> </span><span
	class="typ">SequenceDiagramWriter</span><span class="pln"> </span><span
	class="pun">{</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Method called only one time at the beginning of the diagram writing.<br>&nbsp; &nbsp; &nbsp;* &nbsp;<br>&nbsp; &nbsp; &nbsp;* @param meth the root method.<br>&nbsp; &nbsp; &nbsp;* @throws IOException if any exception when writing.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">void</span><span class="pln"> writeHeader</span><span
	class="pun">(</span><span class="typ">SequenceMethod</span><span
	class="pln"> meth</span><span class="pun">)</span><span class="pln"> </span><span
	class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span
	class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Last method called the end for the diagram writing.<br>&nbsp; &nbsp; &nbsp;* @param meth the root method<br>&nbsp; &nbsp; &nbsp;* @throws IOException if any exception when writing.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">void</span><span class="pln"> writeFooter</span><span
	class="pun">(</span><span class="typ">SequenceMethod</span><span
	class="pln"> meth</span><span class="pun">)</span><span class="pln"> </span><span
	class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span
	class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Method called for writing a method called BEFORE the call of the <br>&nbsp; &nbsp; &nbsp;* {@link #write(SequenceMethod)} on the children.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;* @param meth the method to write<br>&nbsp; &nbsp; &nbsp;* @throws IOException if any problem writing.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">void</span><span class="pln"> writeMethodBeforeChildren</span><span
	class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span
	class="typ">SequenceMethod</span><span class="pln"> meth</span><span
	class="pun">)</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
	class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span
	class="pun">;</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
	class="com">/**<br>&nbsp; &nbsp; &nbsp;* Method called for writing a method called AFTER the call of the <br>&nbsp; &nbsp; &nbsp;* {@link #write(SequenceMethod)} on the children.<br>&nbsp; &nbsp; &nbsp;* <br>&nbsp; &nbsp; &nbsp;* @param meth the method to write<br>&nbsp; &nbsp; &nbsp;* @throws IOException if any problem writing.<br>&nbsp; &nbsp; &nbsp;*/</span><span
	class="pln"><br>&nbsp; &nbsp; </span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">abstract</span><span class="pln"> </span><span
	class="kwd">void</span><span class="pln"> writeMethodAfterChildren</span><span
	class="pun">(</span><span class="kwd">final</span><span class="pln"> </span><span
	class="typ">SequenceMethod</span><span class="pln"> meth</span><span
	class="pun">)</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
	class="kwd">throws</span><span class="pln"> </span><span class="typ">IOException</span><span
	class="pun">;</span><span class="pln"><br></span><span class="pun">}</span></pre>
<p></p>
<h3><a
	name="The_@Aoplib4jSequenceDiagram_annotation:_under_the_hood">The
<tt>@Aoplib4jSequenceDiagram</tt> annotation: under the hood</a></h3>
<p><a name="The_@Aoplib4jSequenceDiagram_annotation:_under_the_hood">The
aspect that manages under the hood the creation of the sequence diagrams
is <tt>org.aoplib4j.uml.SequenceDiagramAspect</tt>. The <tt>SequenceDiagramAspect</tt>
aspect use the </a><a
	href="http://www.eclipse.org/aspectj/doc/released/progguide/semantics-aspects.html#aspect-instantiation"
	rel="nofollow">per-control-flow</a> instantiation model:</p>
<pre class="prettyprint"><span class="lit">@Aspect</span><span
	class="pun">(</span><span class="str">"percflow( "</span><span
	class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
	class="pun">+</span><span class="pln"> </span><span class="str">"execution("</span><span
	class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; </span><span
	class="pun">+</span><span class="pln"> </span><span class="str">"@org.aoplib4j.uml.Aoplib4jSequenceDiagram * * (..)))"</span><span
	class="pun">)</span><span class="pln"><br></span><span class="kwd">public</span><span
	class="pln"> </span><span class="kwd">final</span><span class="pln"> </span><span
	class="kwd">class</span><span class="pln"> </span><span class="typ">SequenceDiagramAspect</span><span
	class="pln"> </span><span class="pun">{</span><span class="pln"><br></span><span
	class="pun">.....</span><span class="pln"><br></span><span
	class="pun">}</span></pre>
<p>So, an instance of <tt>SequenceDiagramAspect</tt> is created for
every execution of a method annotated with the <tt>Aoplib4jSequenceDiagram</tt>
annotation.</p>
<p>The <tt>SequenceDiagramAspect</tt> aspect contains the following
pointcuts:</p>
<ul>
	<li><tt>sequenceDiagramMethodStartPointcut</tt> pointcut</li>
	<pre class="prettyprint"><span class="pln">&nbsp; &nbsp; </span><span
		class="lit">@Pointcut</span><span class="pun">(</span><span
		class="str">"execution("</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"@org.aoplib4j.uml.Aoplib4jSequenceDiagram * * (..))"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">+</span><span class="pln"> </span><span class="str">" &amp;&amp; @annotation(seqAnnot)"</span><span
		class="pun">)</span><span class="pln"> &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; </span><span
		class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span
		class="pln"> sequenceDiagramMethodStartPointcut</span><span
		class="pun">(</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="kwd">final</span><span class="pln"> </span><span class="typ">Aoplib4jSequenceDiagram</span><span
		class="pln"> seqAnnot</span><span class="pun">)</span><span
		class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; </span><span
		class="pun">}</span></pre>
</ul>
<p>The <tt>sequenceDiagramMethodStartPointcut</tt> intercepts the
execution of the methods annotated with the <tt>Aoplib4jSequenceDiagram</tt>,
and the <tt>@annotation</tt> pointcut is used to recover the methods
annotation.</p>
<ul>
	<li><tt>sequenceMethodsPointcut</tt> pointcut</li>
	<pre class="prettyprint"><span class="pln">&nbsp; &nbsp; </span><span
		class="lit">@Pointcut</span><span class="pun">(</span><span
		class="str">"validSequenceDiagramPointcut()"</span><span class="pln"><br>&nbsp; &nbsp; &nbsp;</span><span
		class="pun">+</span><span class="pln"> </span><span class="str">"&amp;&amp; (execution(* *.*(..)) || execution(*.new(..)))"</span><span
		class="pln"> <br>&nbsp; &nbsp; &nbsp;</span><span class="pun">+</span><span
		class="pln"> </span><span class="str">"&amp;&amp; !within (org.aoplib4j.uml.internal.SequenceDiagramAspect)"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp;</span><span class="pun">+</span><span
		class="pln"> </span><span class="str">"&amp;&amp; !cflow (execution (* org.aoplib4j.uml.SequenceDiagramWriter+.*(..)))"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp;</span><span class="pun">+</span><span
		class="pln"> </span><span class="str">"&amp;&amp; !within (org.aoplib4j.uml.SequenceDiagram)"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp;</span><span class="pun">+</span><span
		class="pln"> </span><span class="str">"&amp;&amp; !within (org.aoplib4j.uml.SequenceMethod+)"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp;</span><span class="pun">+</span><span
		class="pln"> </span><span class="str">"&amp;&amp; !within (org.aoplib4j.*.internal.*)"</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span
		class="pun">)</span><span class="pln"> &nbsp; &nbsp;<br>&nbsp; &nbsp; </span><span
		class="kwd">public</span><span class="pln"> </span><span class="kwd">void</span><span
		class="pln"> sequenceMethodsPointcut</span><span class="pun">()</span><span
		class="pln"> </span><span class="pun">{</span><span class="pln"><br><br>&nbsp; &nbsp; </span><span
		class="pun">}</span></pre>
</ul>
<p>The <tt>sequenceMethodsPointcut</tt> intercepts the execution of
all the methods inside the flow of a method annotated with <tt>Aoplib4jSequenceDiagram</tt>
beside the methods inside the <tt>SequenceDiagramWriter</tt>, <tt>SequenceDiagram</tt>
and <tt>SequenceMethod</tt> which are not part of the original flow. To
know if an method execution is inside the flow of an annotated method
the <tt>validSequenceDiagramPointcut</tt> pointcut is used.</p>
<ul>
	<li><tt>validSequenceDiagramPointcut</tt> pointcut</li>
	<pre class="prettyprint"><span class="pln">&nbsp; &nbsp; </span><span
		class="lit">@Pointcut</span><span class="pun">(</span><span
		class="str">"if()"</span><span class="pun">)</span><span class="pln"><br>&nbsp; &nbsp; </span><span
		class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span
		class="pln"> </span><span class="kwd">boolean</span><span class="pln"> validSequenceDiagramPointcut</span><span
		class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; <br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="kwd">boolean</span><span class="pln"> aspectAttached </span><span
		class="pun">=</span><span class="pln"> </span><span class="typ">Aspects</span><span
		class="pun">.</span><span class="pln">hasAspect</span><span
		class="pun">(</span><span class="typ">SequenceDiagramAspect</span><span
		class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span
		class="pln">aspectAttached</span><span class="pun">)</span><span
		class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="typ">SequenceDiagramAspect</span><span class="pln"> instance </span><span
		class="pun">=</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="typ">Aspects</span><span class="pun">.</span><span class="pln">aspectOf</span><span
		class="pun">(</span><span class="typ">SequenceDiagramAspect</span><span
		class="pun">.</span><span class="kwd">class</span><span class="pun">);</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="com">// instance.maxDiagramDepth - 1 because the next executed method will</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="com">//increase the actual diagram depth with 1.</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span
		class="pln">instance</span><span class="pun">.</span><span class="pln">insideSequenceDiagram<br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="pun">&amp;&amp;</span><span class="pln"> instance</span><span
		class="pun">.</span><span class="pln">seqDiagram</span><span
		class="pun">.</span><span class="pln">getDiagramDepth</span><span
		class="pun">()</span><span class="pln"> <br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="pun">&lt;=</span><span class="pln"> instance</span><span
		class="pun">.</span><span class="pln">seqDiagram</span><span
		class="pun">.</span><span class="pln">getMaxDiagramDepth</span><span
		class="pun">()</span><span class="pln"> </span><span class="pun">-</span><span
		class="pln"> </span><span class="lit">1</span><span class="pun">);</span><span
		class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span
		class="pln"> </span><span class="pun">{</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="kwd">return</span><span class="pln"> </span><span class="kwd">false</span><span
		class="pun">;</span><span class="pln"><br>&nbsp; &nbsp; &nbsp; &nbsp;</span><span
		class="pun">}</span><span class="pln"><br>&nbsp;<br>&nbsp; &nbsp; </span><span
		class="pun">}</span></pre>
</ul>
<blockquote>The <tt>validSequenceDiagramPointcut</tt>
pointcut is used to distinguish if a pointcut is a valid pointcut for
the writing of the (sequence)diagram. A pointcut is valid if :

<ul>
	<li>the pointcut is inside of the control flow of the <tt>sequenceDiagramMethodStartPointcut(Aoplib4jSequenceDiagram)</tt>
	pointcut, so the</li>
</ul>
</blockquote>
<p><tt>SequenceDiagramAspect.insideSequenceDiagram</tt> field is
true.</p>
<ul>
	<li>the current depth of the diagram is smaller or equal than the
	maximum diagram depth.</li>
</ul>
<blockquote>The <tt>cflow()</tt> pointcut is not use
because it is not a statically determinable pointcut and so the <tt>around</tt>
and <tt>aflter</tt> advices cannot be applied.</blockquote>
<h3><a
	name="Critics,_enhancements_and_..._what_i_don't_like_about_this">Critics,
enhancements and ... what i don't like about this solution</a></h3>
<ul>
	<li><a
		name="Critics,_enhancements_and_..._what_i_don't_like_about_this">The
	user validation class must inherit from <tt>SequenceDiagramWriter</tt>
	class. It would be much better to just implement a Java interface. In
	the actual implementation the user must inherit from a class because
	the framework instantiate the writer class using the non-arguments
	constructor by introspection (see </a><a
		href="http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#newInstance%28%29"
		rel="nofollow">Class.newInstance()</a>).</li>
	<li>I don't like the way the <tt>validSequenceDiagramPointcut</tt>
	is designed; the use of the <tt>execution(* *.*(..)) ||
	execution(*.new(..)))</tt> pointcut is very expensive for the weaver
	(compiler or runtime), but it was the only way to intercept the
	execution of all the methods inside the flow of a annotated method and
	to use the pointcut with the <tt>around</tt> advice.</li>